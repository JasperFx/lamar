<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Building Custom Frames | Lamar</title>
    <meta name="description" content=".NET Fast Inversion of Control and Dynamic code weaving tools">
    <link rel="stylesheet" href="/lamar/assets/style.5189d035.css">
    <link rel="modulepreload" href="/lamar/assets/Home.a9a40d4a.js">
    <link rel="modulepreload" href="/lamar/assets/AlgoliaSearchBox.f3e27e7a.js">
    <link rel="modulepreload" href="/lamar/assets/app.80913d4a.js">
    <link rel="modulepreload" href="/lamar/assets/guide_compilation_frames_frame.md.a9228ffe.lean.js">
    <link rel="modulepreload" href="/lamar/assets/app.80913d4a.js">
    <meta name="twitter:title" content="Building Custom Frames | Lamar">
    <meta property="og:title" content="Building Custom Frames | Lamar">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-7161a24b><div class="sidebar-button" data-v-7161a24b><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/lamar/" aria-label="Lamar, back to home" data-v-7161a24b data-v-4a583abe><!----> Lamar</a><div class="flex-grow" data-v-7161a24b></div><div class="nav" data-v-7161a24b><nav class="nav-links" data-v-7161a24b data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item" href="/lamar/guide/" data-v-641633f9>Guide <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item isExternal" href="https://github.com/JasperFx/lamar/releases" target="_blank" rel="noopener noreferrer" data-v-641633f9>Release Notes <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-641633f9><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item isExternal" href="https://gitter.im/JasperFx/lamar?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank" rel="noopener noreferrer" data-v-641633f9>Gitter | Join Chat <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-641633f9><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item isExternal" href="https://github.com/JasperFx/lamar" target="_blank" rel="noopener noreferrer" data-v-641633f9>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-641633f9><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--[--><div class="algolia-search-box" id="docsearch"></div><!--]--><!--]--></header><aside class="sidebar" data-v-6b49cdcd><nav class="nav-links nav" data-v-6b49cdcd data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item" href="/lamar/guide/" data-v-641633f9>Guide <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item isExternal" href="https://github.com/JasperFx/lamar/releases" target="_blank" rel="noopener noreferrer" data-v-641633f9>Release Notes <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-641633f9><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item isExternal" href="https://gitter.im/JasperFx/lamar?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank" rel="noopener noreferrer" data-v-641633f9>Gitter | Join Chat <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-641633f9><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item isExternal" href="https://github.com/JasperFx/lamar" target="_blank" rel="noopener noreferrer" data-v-641633f9>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-641633f9><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-6b49cdcd><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/">Getting Started</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/">Inversion of Control</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/concepts">Software Design Concepts</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/bootstrapping">Bootstrapping a Container</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/aspnetcore">Integration with ASP.NET Core</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/blazor">Integration with Blazor</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/registration/">Registration</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/registration/registry-dsl">ServiceRegistry DSL</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/registration/inline-dependencies">Inline Dependencies</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/registration/auto-registration-and-conventions">Auto-Registration and Conventions</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/registration/configured-instance">Working with IConfiguredInstance</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/registration/policies">Policies</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/registration/changing-configuration-at-runtime">Changing Configuration at Runtime</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/registration/constructor-selection">Constructor Selection</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/registration/existing-objects">Registering Existing Objects</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/registration/attributes">Using Attributes for Configuration</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/lifetime">Service Lifetimes</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/resolving/">Resolving Services</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/resolving/get-a-service-by-plugin-type">Get a Service by PluginType</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/resolving/get-a-service-by-plugin-type-and-name">Get a Service by Plugin Type and Name</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/resolving/get-all-services-by-plugin-type">Get all Services by Plugin Type</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/resolving/try-getting-an-optional-service-by-plugin-type">Try Getting an Optional Service by Plugin Type</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/resolving/try-getting-an-optional-service-by-plugin-type-and-name">Try Getting an Optional Service by Plugin Type and Name</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/resolving/requesting-a-concrete-type">Auto Resolving Concrete Types</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/generics">Generic Types</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/decorators">Decorators</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/diagnostics/">Lamar Diagnostics</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/diagnostics/what-do-i-have">WhatDoIHave()</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/diagnostics/validating-container-configuration">Validating Container Configuration</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/diagnostics/environment-tests">Environment Tests</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/diagnostics/build-plans">Build Plans</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/diagnostics/using-the-container-model">Using the Container Model</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/diagnostics/type-scanning">Type Scanning Diagnostics</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/auto-wiring">Auto Wiring</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/lambdas">Building Objects with Lambdas</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/injecting-at-runtime">Injecting Services at Runtime</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/disposing">Lamar and IDisposable</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/lazy-resolution">Lazy Resolution</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/nested-containers">Nested Containers (Per Request/Transaction)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/setter-injection">Setter Injection</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/ioc/working-with-enumerable-types">Working with Enumerable Types</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/compilation/">Compilation</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/compilation/assembly-generator">Compiling code with AssemblyGenerator</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/compilation/source-writer">Generating code with ISourceWriter</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/compilation/frames/">The &quot;Frame&quot; Model</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/compilation/frames/variables">Working with Variables</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/lamar/guide/compilation/frames/frame">Building custom Frames</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#creating-a-variable-within-a-frame">Creating a Variable within a Frame</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#finding-dependent-variables">Finding Dependent Variables</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/compilation/frames/extension-methods">Extension methods for Names in code</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/lamar/guide/compilation/frames/injected-fields">Injected Fields</a><!----></li></ul></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="building-custom-frames"><a class="header-anchor" href="#building-custom-frames" aria-hidden="true">#</a> Building Custom Frames</h1><div class="tip custom-block"><p class="custom-block-title">INFO</p><p>If you&#39;re going to get into LamarCodeGeneration&#39;s model, you probably want to be familiar and comfortable with both string interpolation in C# and the recent <code>nameof</code> operator.</p></div><p>To build a custom frame, you first need to create a new class that subclasses <code>Frame</code>, with these other more specific subclasses to start from as well:</p><ul><li><code>SyncFrame</code> - a frame that generates purely synchronous code</li><li><code>AsyncFrame</code> - a frame that has at least one <code>await</code> call in the code generated</li></ul><p>The one thing you absolutely have to do when you create a new <code>Frame</code> class is to override the <code>GenerateCode()</code> method. Take this example from Lamar itself for a frame that just injects a comment into the generated code:</p><!-- snippet: sample_CommentFrame --><p><a id="snippet-sample_commentframe"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommentFrame</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">SyncFrame</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">string</span></span> _commentText<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">CommentFrame</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> commentText<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _commentText <span class="token operator">=</span> commentText<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GenerateCode</span><span class="token punctuation">(</span><span class="token class-name">GeneratedMethod</span> method<span class="token punctuation">,</span> <span class="token class-name">ISourceWriter</span> writer<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        writer<span class="token punctuation">.</span><span class="token function">WriteComment</span><span class="token punctuation">(</span>_commentText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// It&#39;s on you to call through to a possible next</span>
        <span class="token comment">// frame to let it generate its code</span>
        Next<span class="token punctuation">?.</span><span class="token function">GenerateCode</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> writer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/LamarCodeGeneration/Frames/Frame.cs#L16-L35" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_commentframe" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><p>A couple things to note about the <code>GenerateCode()</code> method:</p><ul><li>The <code>GeneratedMethod</code> will tell you information about the new method being generated like the return type and whether or not the method returns a <code>Task</code> or is marked with the <code>async</code> keyword.</li><li>You use the <code>ISourceWriter</code> argument to write new code into the generated method</li><li>It&#39;s your responsibility to call the <code>Next?.GenerateCode()</code> method to give the next frame a chance to write its code. <strong>Don&#39;t forget to do this step</strong>.</li></ul><p>Inside a custom frame, you can also nest the code from the frames following yours in a method. See this frame from Lamar itself that calls a &quot;no arg&quot; constructor on a concrete class and returns a variable. In the case of a class that implements <code>IDisposable</code>, it should write a C# <code>using</code> block that surrounds the inner code:</p><!-- snippet: sample_NoArgCreationFrame --><p><a id="snippet-sample_noargcreationframe"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NoArgCreationFrame</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">SyncFrame</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">NoArgCreationFrame</span><span class="token punctuation">(</span><span class="token class-name">Type</span> concreteType<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token comment">// By creating the variable this way, we&#39;re</span>
        <span class="token comment">// marking the variable as having been created</span>
        <span class="token comment">// by this frame</span>
        Output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Variable</span><span class="token punctuation">(</span>concreteType<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">Variable</span> Output <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// You have to override this method</span>
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GenerateCode</span><span class="token punctuation">(</span><span class="token class-name">GeneratedMethod</span> method<span class="token punctuation">,</span> <span class="token class-name">ISourceWriter</span> writer<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> creation <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$&quot;var </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Output<span class="token punctuation">.</span>Usage</span><span class="token punctuation">}</span></span><span class="token string"> = new </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Output<span class="token punctuation">.</span>VariableType<span class="token punctuation">.</span><span class="token function">FullNameInCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">()&quot;</span></span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>Output<span class="token punctuation">.</span>VariableType<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">CanBeCastTo</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IDisposable<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// there is an ISourceWriter shortcut for this, but this makes</span>
            <span class="token comment">// a better code demo;)</span>
            writer<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;BLOCK:using (</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">creation</span><span class="token punctuation">}</span></span><span class="token string">)&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Next<span class="token punctuation">?.</span><span class="token function">GenerateCode</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> writer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            writer<span class="token punctuation">.</span><span class="token function">FinishBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>creation <span class="token operator">+</span> <span class="token string">&quot;;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Next<span class="token punctuation">?.</span><span class="token function">GenerateCode</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> writer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/Lamar.Testing/Examples/NoArgConstructor.cs#L9-L42" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_noargcreationframe" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><h2 id="creating-a-variable-within-a-frame"><a class="header-anchor" href="#creating-a-variable-within-a-frame" aria-hidden="true">#</a> Creating a Variable within a Frame</h2><p>If the code generated by a <code>Frame</code> creates a new <code>Variable</code> in the generated code, it should set itself as the creator of that variable. You can do that by either passing a frame into a variable as its creator like this line from the <code>NoArgCreationFrame</code> shown above:</p><!-- snippet: sample_NoArgCreationFrameCtor --><p><a id="snippet-sample_noargcreationframector"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token function">NoArgCreationFrame</span><span class="token punctuation">(</span><span class="token class-name">Type</span> concreteType<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token comment">// By creating the variable this way, we&#39;re</span>
    <span class="token comment">// marking the variable as having been created</span>
    <span class="token comment">// by this frame</span>
    Output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Variable</span><span class="token punctuation">(</span>concreteType<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/Lamar.Testing/Examples/NoArgConstructor.cs#L47-L55" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_noargcreationframector" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><p>Otherwise, you could also have written that code like this:</p><!-- snippet: sample_NoArgCreationFrameCtor2 --><p><a id="snippet-sample_noargcreationframector2"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token function">NoArgCreationFrame</span><span class="token punctuation">(</span><span class="token class-name">Type</span> concreteType<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token comment">// By creating the variable this way, we&#39;re</span>
    <span class="token comment">// marking the variable as having been created</span>
    <span class="token comment">// by this frame</span>
    Output <span class="token operator">=</span> <span class="token function">Create</span><span class="token punctuation">(</span>concreteType<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/Lamar.Testing/Examples/NoArgConstructor.cs#L58-L66" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_noargcreationframector2" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><h2 id="finding-dependent-variables"><a class="header-anchor" href="#finding-dependent-variables" aria-hidden="true">#</a> Finding Dependent Variables</h2><p>The other main thing you need to know is how to locate <code>Variable</code> objects your <code>Frame</code> needs to use. You accomplish that by overriding the <code>FindVariables()</code> method. Take this example below that is used within Lamar to generate code that resolves a service by calling a <a href="https://en.wikipedia.org/wiki/Service_locator_pattern" target="_blank" rel="noopener noreferrer">service locator</a> method on a Lamar <code>Scope</code> (a nested container most likely) object:</p><!-- snippet: sample_GetInstanceFrame --><p><a id="snippet-sample_getinstanceframe"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GetInstanceFrame</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">SyncFrame</span><span class="token punctuation">,</span> <span class="token class-name">IResolverFrame</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name">MethodInfo</span> _resolveMethod <span class="token operator">=</span>
        ReflectionHelper<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetMethod</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Instance<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">Resolve</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    
    
    <span class="token keyword">private</span> <span class="token class-name">Variable</span> _scope<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">string</span></span> _name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">GetInstanceFrame</span><span class="token punctuation">(</span><span class="token class-name">Instance</span> instance<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Variable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ServiceVariable</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> ServiceDeclaration<span class="token punctuation">.</span>ServiceType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        _name <span class="token operator">=</span> instance<span class="token punctuation">.</span>Name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GenerateCode</span><span class="token punctuation">(</span><span class="token class-name">GeneratedMethod</span> method<span class="token punctuation">,</span> <span class="token class-name">ISourceWriter</span> writer<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        writer<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;var </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Variable<span class="token punctuation">.</span>Usage</span><span class="token punctuation">}</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_scope<span class="token punctuation">.</span>Usage</span><span class="token punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">nameof</span><span class="token punctuation">(</span>Scope<span class="token punctuation">.</span>GetInstance<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">&lt;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Variable<span class="token punctuation">.</span>VariableType<span class="token punctuation">.</span><span class="token function">FullNameInCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">&gt;(\&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_name</span><span class="token punctuation">}</span></span><span class="token string">\&quot;);&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Next<span class="token punctuation">?.</span><span class="token function">GenerateCode</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> writer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>Variable<span class="token punctuation">&gt;</span></span> <span class="token function">FindVariables</span><span class="token punctuation">(</span><span class="token class-name">IMethodVariables</span> chain<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _scope <span class="token operator">=</span> chain<span class="token punctuation">.</span><span class="token function">FindVariable</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Scope</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">yield</span> <span class="token keyword">return</span> _scope<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token return-type class-name">ServiceVariable</span> Variable <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">WriteExpressions</span><span class="token punctuation">(</span><span class="token class-name">LambdaDefinition</span> definition<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> scope <span class="token operator">=</span> definition<span class="token punctuation">.</span><span class="token function">Scope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> expr <span class="token operator">=</span> definition<span class="token punctuation">.</span><span class="token function">ExpressionFor</span><span class="token punctuation">(</span>Variable<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name"><span class="token keyword">var</span></span> instance <span class="token operator">=</span> Variable<span class="token punctuation">.</span>Instance<span class="token punctuation">;</span>

        <span class="token class-name"><span class="token keyword">var</span></span> @call <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span>Expression<span class="token punctuation">.</span><span class="token function">Constant</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">,</span> _resolveMethod<span class="token punctuation">,</span> scope<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> assign <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Assign</span><span class="token punctuation">(</span>expr<span class="token punctuation">,</span> Expression<span class="token punctuation">.</span><span class="token function">Convert</span><span class="token punctuation">(</span>@call<span class="token punctuation">,</span> Variable<span class="token punctuation">.</span>VariableType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        definition<span class="token punctuation">.</span>Body<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>assign<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>Next <span class="token keyword">is</span> <span class="token class-name">IResolverFrame</span> next<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            next<span class="token punctuation">.</span><span class="token function">WriteExpressions</span><span class="token punctuation">(</span>definition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">InvalidCastException</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Next<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetFullName</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string"> does not implement </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">nameof</span><span class="token punctuation">(</span>IResolverFrame<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/Lamar/IoC/Frames/GetInstanceFrame.cs#L15-L68" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_getinstanceframe" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><p>When you write a <code>FindVariables()</code> method, be sure to keep a reference to any variable you need for later, and return that variable as part of the enumeration from this method. Lamar uses the dependency relationship between frames, the variables they depend on, and the creators of those variables to correctly order and fill in any missing frames prior to generating code through the <code>GenerateCode()</code> method.</p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><a class="link" href="https://github.com/JasperFx/lamar/edit/master/docs/guide/compilation/frames/frame.md" target="_blank" rel="noopener noreferrer" data-v-1ed99556>Suggest changes to this page <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-1ed99556><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/lamar/guide/compilation/frames/variables" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>Working with Variables</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/lamar/guide/compilation/frames/extension-methods" data-v-38ede35f><span class="text" data-v-38ede35f>Extension methods for Names in code</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"09eb3057\",\"guide_index.md\":\"e0f0cc1c\",\"guide_compilation_assembly-generator.md\":\"f7ea27b8\",\"guide_compilation_index.md\":\"98edc4ea\",\"guide_compilation_source-writer.md\":\"5c84fe4f\",\"guide_ioc_aspnetcore.md\":\"26205e8c\",\"guide_ioc_auto-wiring.md\":\"697eb6eb\",\"guide_ioc_blazor.md\":\"4b724a79\",\"guide_ioc_bootstrapping.md\":\"aa9d1a25\",\"guide_ioc_concepts.md\":\"016f2eba\",\"guide_ioc_decorators.md\":\"d4efb6cd\",\"guide_ioc_disposing.md\":\"ac8c0ba8\",\"guide_ioc_generics.md\":\"cbf8ceb9\",\"guide_ioc_index.md\":\"309a588e\",\"guide_ioc_injecting-at-runtime.md\":\"dc7d83d9\",\"guide_ioc_lambdas.md\":\"e6526ccb\",\"guide_ioc_lazy-resolution.md\":\"bb9ed34c\",\"guide_ioc_lifetime.md\":\"b33e34b3\",\"guide_ioc_nested-containers.md\":\"341524b4\",\"guide_ioc_setter-injection.md\":\"3fbf89ff\",\"guide_ioc_working-with-enumerable-types.md\":\"b13cbece\",\"guide_compilation_frames_extension-methods.md\":\"6d05142c\",\"guide_compilation_frames_frame.md\":\"a9228ffe\",\"guide_compilation_frames_index.md\":\"3fb49576\",\"guide_compilation_frames_injected-fields.md\":\"0ea4d450\",\"guide_compilation_frames_variables.md\":\"04f6f915\",\"guide_ioc_diagnostics_build-plans.md\":\"250bdff1\",\"guide_ioc_diagnostics_environment-tests.md\":\"e1027576\",\"guide_ioc_diagnostics_index.md\":\"8f826691\",\"guide_ioc_diagnostics_type-scanning.md\":\"3f67ff16\",\"guide_ioc_diagnostics_using-the-container-model.md\":\"ddb7151f\",\"guide_ioc_diagnostics_validating-container-configuration.md\":\"7d347cd2\",\"guide_ioc_diagnostics_what-do-i-have.md\":\"402491eb\",\"guide_ioc_registration_attributes.md\":\"9e65b5b3\",\"guide_ioc_registration_auto-registration-and-conventions.md\":\"2a16687a\",\"guide_ioc_registration_changing-configuration-at-runtime.md\":\"4ac65001\",\"guide_ioc_registration_configured-instance.md\":\"3e4f8627\",\"guide_ioc_registration_constructor-selection.md\":\"03dbb9a0\",\"guide_ioc_registration_existing-objects.md\":\"f92a2534\",\"guide_ioc_registration_index.md\":\"d6338306\",\"guide_ioc_registration_inline-dependencies.md\":\"edd21fe1\",\"guide_ioc_registration_policies.md\":\"9605c602\",\"guide_ioc_registration_registry-dsl.md\":\"915a9fd0\",\"guide_ioc_resolving_get-a-service-by-plugin-type-and-name.md\":\"2c47a1fb\",\"guide_ioc_resolving_get-a-service-by-plugin-type.md\":\"d9644569\",\"guide_ioc_resolving_get-all-services-by-plugin-type.md\":\"91d00ec1\",\"guide_ioc_resolving_index.md\":\"5d1623c4\",\"guide_ioc_resolving_requesting-a-concrete-type.md\":\"25f50bfb\",\"guide_ioc_resolving_try-getting-an-optional-service-by-plugin-type-and-name.md\":\"52cf539c\",\"guide_ioc_resolving_try-getting-an-optional-service-by-plugin-type.md\":\"511cccad\"}")</script>
    <script type="module" async src="/lamar/assets/app.80913d4a.js"></script>
  </body>
</html>