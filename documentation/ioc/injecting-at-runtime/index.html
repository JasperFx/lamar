<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
        <meta name="generator" content="Bootply" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <title>Lamar - Injecting Services at Runtime</title>
        <link href="/lamar/content/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/lamar/content/prism.css" rel="stylesheet" type="text/css" />
        <link href="/lamar/content/theme.css" rel="stylesheet" type="text/css" />

        <link rel="apple-touch-icon" href="/bootstrap/img/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="72x72" href="/bootstrap/img/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="/bootstrap/img/apple-touch-icon-114x114.png">

        <link href="/lamar/content/affix.css" rel="stylesheet" type="text/css" />
    </head>

    <body>

      <a href="https://github.com/jasperfx/Lamar"><img style="z-index: 5000; position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>

      <nav class="navbar navbar-default navbar-fixed-top" role="banner">
      <div class="container">
        <div class="navbar-header">
          <a href="/lamar" class="navbar-brand">Lamar</a>
        </div>
        <nav class="collapse navbar-collapse" role="navigation">
          <ul class="nav navbar-nav pull-right">
            <li>
              <a href="/lamar/getting_started">Getting Started</a>
            </li>
            <li>
              <a href="/lamar/documentation">Documentation</a>
            </li>
            <li>
              <a href="https://gitter.im/jasperfx/Lamar?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://camo.githubusercontent.com/da2edb525cde1455a622c58c0effc3a90b9a181c/68747470733a2f2f6261646765732e6769747465722e696d2f4a6f696e253230436861742e737667" alt="Join the chat at https://gitter.im/jasperfx/Lamar" data-canonical-src="https://badges.gitter.im/Join%20Chat.svg" style="max-width:100%;"></a>
            </li>
            <li><a href="/lamar/documentation/ioc/lambdas" title="Building Objects with Lambdas">Previous</a></li>
            <li><a href="/lamar/documentation/ioc/disposing" title="Lamar and IDisposable">Next</a></li>
          </ul>
          <div class="navbar-form navbar-left" role="search">
            <div class="form-group">
              <input id="search" type="search" class="form-control" placeholder="Search">
            </div>
          </div>

        </nav>

      </div>
    </nav>

    <div class="container">
      <nav class="navbar-inverse">
        <ol class="breadcrumb"><li><a href="/lamar/">Lamar</a></li><li><a href="/lamar/documentation">Documentation</a></li><li><a href="/lamar/documentation/ioc">Lamar as IoC Container</a></li><li class="active">Injecting Services at Runtime</li></ol>
      </nav>
    </div>

    <!--main-->
    <div class="container">
      <div class="row">
          <!--left-->
          <div class="col-md-3" id="leftCol">
            <h3>Lamar 0.9.11</h3>
            <br />

            <ul class="nav nav-stacked affix" id="sidebar">
            </ul>

            <h3 class="no-margin">Next</h3><p><a href="/lamar/documentation/ioc/disposing">Lamar and IDisposable</a></p>
            <h3 class="no-margin">Previous</h3><a href="/lamar/documentation/ioc/lambdas">Building Objects with Lambdas</a></p>
          </div><!--/left-->

          <!--right-->
          <div class="col-md-9">
              <h1>Injecting Services at Runtime</h1>

              <hr />

              <div id="main-pane">
                <!--title:Injecting Services at Runtime-->
<p>Lamar's predecessor <a href="https://structuremap.github.io">StructureMap</a> allowed you to override service registrations in nested containers in a general way.
Some .Net application frameworks depend on this functionality to inject some kind of contextual service into a nested container. ASP.Net Core's <code>HttpContext</code> is an example. MassTransit's <a href="https://github.com/MassTransit/MassTransit/blob/develop/src/MassTransit/ConsumeContext.cs">ConsumeContext</a> is another.</p>
<p>Using that as an example, let's say that our application framework has this context type that the framework creates and wants to inject directly
into nested containers for some kind of operation:</p>
<pre><code class="language-csharp">&#xA;// This class is specific to some kind of short lived &#xA;// process and lives in a nested container&#xA;public class ExecutionContext&#xA;{&#xA;    public Guid Id { get; set; } = Guid.NewGuid();&#xA;}&#xA;</code></pre>
<p>We might well have a service in our code that is resolved from a Lamar container that depends on that <code>ExecutionContext</code> interface:</p>
<pre><code class="language-csharp">&#xA;public class ContextUsingService&#xA;{&#xA;    public ExecutionContext Context { get; }&#xA;&#xA;    public ContextUsingService(ExecutionContext context)&#xA;    {&#xA;        Context = context;&#xA;    }&#xA;}&#xA;</code></pre>
<p>The first thing we have to do is make a registration in Lamar <strong>upfront</strong> that lets the container know that <code>ExecutionContext</code> is going to be injected
at runtime:</p>
<pre><code class="language-csharp">&#xA;var container = new Container(_ =&gt;&#xA;{&#xA;    _.Injectable&lt;ExecutionContext&gt;();&#xA;});&#xA;</code></pre>
<p>At runtime, we can inject <code>ExecutionContext</code> like this:</p>
<pre><code class="language-csharp">&#xA;var context = new ExecutionContext();&#xA;&#xA;var nested = container.GetNestedContainer();&#xA;nested.Inject(context);&#xA;</code></pre>
<p>Finally, when we resolve a service that depends on <code>ExecutionContext</code> from the nested container
we built above, we can see that it has a reference to our context object:</p>
<pre><code class="language-csharp">&#xA;var service = nested.GetInstance&lt;ContextUsingService&gt;();&#xA;service.Context.ShouldBeSameAs(context);&#xA;</code></pre>

              </div>

              <hr />

              <nav>
                <span>
                  <strong>Previous: </strong><a href="/lamar/documentation/ioc/lambdas">Building Objects with Lambdas</a>

                </span>
                <span class="pull-right">

                  <strong>Next: </strong><a href="/lamar/documentation/ioc/disposing">Lamar and IDisposable</a>

                </span>
              </nav>

          </div><!--/right-->
        </div><!--/row-->
      </div><!--/container-->

    </body>


    <footer>
        <script type='text/javascript' src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script type='text/javascript' src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

        <script type="text/javascript" src="/lamar/content/prism.js"></script>
        <script type="text/javascript" src="/lamar/content/sidebar.js"></script>
        <script type="text/javascript" src="/lamar/content/affix.js"></script>

<script>
$('#search').keyup(function(e){
  if(e.keyCode == 13) {
    var search = $('#search').val();

    var url = 'https://www.google.com/#q=site:jasperfx.github.io ' + search;
    url = encodeURI(url);

    window.location.href = url;

    e.stopPropagation();
    if (e.cancelBubble!=null) e.cancelBubble = true;
    return false;
  }
});
</script>
    </footer>
</html>
