<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
        <meta name="generator" content="Bootply" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <title>Lamar - Registration</title>
        <link href="/lamar/content/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/lamar/content/prism.css" rel="stylesheet" type="text/css" />
        <link href="/lamar/content/theme.css" rel="stylesheet" type="text/css" />

        <link rel="apple-touch-icon" href="/bootstrap/img/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="72x72" href="/bootstrap/img/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="/bootstrap/img/apple-touch-icon-114x114.png">

        <link href="/lamar/content/affix.css" rel="stylesheet" type="text/css" />
    </head>

    <body>

      <a href="https://github.com/jasperfx/Lamar"><img style="z-index: 5000; position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>

      <nav class="navbar navbar-default navbar-fixed-top" role="banner">
      <div class="container">
        <div class="navbar-header">
          <a href="/lamar" class="navbar-brand">Lamar</a>
        </div>
        <nav class="collapse navbar-collapse" role="navigation">
          <ul class="nav navbar-nav pull-right">
            <li>
              <a href="/lamar/getting_started">Getting Started</a>
            </li>
            <li>
              <a href="/lamar/documentation">Documentation</a>
            </li>
            <li>
              <a href="https://gitter.im/jasperfx/Lamar?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://camo.githubusercontent.com/da2edb525cde1455a622c58c0effc3a90b9a181c/68747470733a2f2f6261646765732e6769747465722e696d2f4a6f696e253230436861742e737667" alt="Join the chat at https://gitter.im/jasperfx/Lamar" data-canonical-src="https://badges.gitter.im/Join%20Chat.svg" style="max-width:100%;"></a>
            </li>
            <li><a href="/lamar/documentation/ioc/aspnetcore" title="Integration with ASP.Net Core">Previous</a></li>
            <li><a href="/lamar/documentation/ioc/registration/registry-dsl" title="ServiceRegistry DSL">Next</a></li>
          </ul>
          <div class="navbar-form navbar-left" role="search">
            <div class="form-group">
              <input id="search" type="search" class="form-control" placeholder="Search">
            </div>
          </div>

        </nav>

      </div>
    </nav>

    <div class="container">
      <nav class="navbar-inverse">
        <ol class="breadcrumb"><li><a href="/lamar/">Lamar</a></li><li><a href="/lamar/documentation">Documentation</a></li><li><a href="/lamar/documentation/ioc">Lamar as IoC Container</a></li><li class="active">Registration</li></ol>
      </nav>
    </div>

    <!--main-->
    <div class="container">
      <div class="row">
          <!--left-->
          <div class="col-md-3" id="leftCol">
            <h3>Lamar 2.0.0</h3>
            <br />

            <ul class="nav nav-stacked affix" id="sidebar">
            </ul>

            <h3 class="no-margin">Next</h3><p><a href="/lamar/documentation/ioc/registration/registry-dsl">ServiceRegistry DSL</a></p>
            <h3 class="no-margin">Previous</h3><a href="/lamar/documentation/ioc/aspnetcore">Integration with ASP.Net Core</a></p>
          </div><!--/left-->

          <!--right-->
          <div class="col-md-9">
              <h1>Registration</h1>

              <hr />

              <div id="main-pane">
                <!--Title: Registration-->
<!--Url: registration-->
<p>Lamar provides a streamlined fluent interface called the <em>Registry DSL</em> to configure a Lamar
Container with both explicit registrations and conventional auto-registrations based on the older <a href="http://structuremap.github.io/registration/registry-dsl/">StructureMap syntax</a>. In addition, Lamar also directly supports the <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection?view=aspnetcore-2.1">ASP.Net Core DI style
of service registrations</a> (<a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.extensions.dependencyinjection.iservicecollection?view=aspnetcore-2.1">IServiceCollection</a>) to ease the usage of Lamar with the entire .Net Core ecosystem.</p>
<p>The first step in using Lamar is configuring a <code>Container</code> object. The following examples are based on the usage of the <a href="/lamar/documentation/ioc/registration/registry-dsl">ServiceRegistry DSL</a>.</p>
<p>Let's say that you have a simple set of services like this:</p>
<pre><code class="language-csharp">&#xA;public interface IBar&#xA;{&#xA;}&#xA;&#xA;public class Bar : IBar&#xA;{&#xA;}&#xA;&#xA;public interface IFoo&#xA;{&#xA;}&#xA;&#xA;public class Foo : IFoo&#xA;{&#xA;    public IBar Bar { get; private set; }&#xA;&#xA;    public Foo(IBar bar)&#xA;    {&#xA;        Bar = bar;&#xA;    }&#xA;}&#xA;&#xA;</code></pre>
<p>A simple configuration of a Lamar Container might then be:</p>
<pre><code class="language-csharp">&#xA;// Example #1 - Create an container instance and directly pass in the configuration.&#xA;            var container1 = new Container(c =&gt;&#xA;            {&#xA;                c.For&lt;IFoo&gt;().Use&lt;Foo&gt;();&#xA;                c.For&lt;IBar&gt;().Use&lt;Bar&gt;();&#xA;            });&#xA;&#xA;// Example #2 - Create an container instance but add configuration later.&#xA;            var container2 = new Container();&#xA;&#xA;            container2.Configure(c =&gt;&#xA;            {&#xA;                c.For&lt;IFoo&gt;().Use&lt;Foo&gt;();&#xA;                c.For&lt;IBar&gt;().Use&lt;Bar&gt;();&#xA;            });&#xA;</code></pre>
<p>Initializing or configuring the container is usually done at application startup and is located as close as possible to the application's entry point.
This place is sometimes referred to as the composition root of the application.
In our example we are composing our application's object graph by connecting abstractions to concrete types.</p>
<p>We are using the fluent API <code>For&lt;TInterface&gt;().Use&lt;TConcrete&gt;()</code> which registers a default instance for a given plugin type (the TInterface type in this case). In our example we want an new instance of <code>Foo</code> every time we request the abstraction <code>IFoo</code>.</p>
<p>The recommended way of using the <a href="/lamar/documentation/ioc/registration/registry-dsl">ServiceRegistry DSL</a> is by defining one or more <code>ServiceRegistry</code> classes. Typically, you would subclass the <code>ServiceRegistry</code> class,
then use the Fluent API methods exposed by the <code>ServiceRegistry</code> class to describe a <code>Container</code> configuration.</p>
<p>Here's a sample <code>ServiceRegistry</code> class used to configure the same types as in our previous example:</p>
<pre><code class="language-csharp">&#xA;public class FooBarRegistry : Registry&#xA;{&#xA;    public FooBarRegistry()&#xA;    {&#xA;        For&lt;IFoo&gt;().Use&lt;Foo&gt;();&#xA;        For&lt;IBar&gt;().Use&lt;Bar&gt;();&#xA;    }&#xA;}&#xA;&#xA;</code></pre>
<p>When you set up a <code>Container</code> , you need to simply direct the <code>Container</code> to use the configuration in that <code>ServiceRegistry</code> class.</p>
<pre><code class="language-csharp">&#xA;// Example #1&#xA;            var container1 = new Container(new FooBarRegistry());&#xA;&#xA;// Example #2&#xA;            var container2 = new Container(c =&gt; { c.AddRegistry&lt;FooBarRegistry&gt;(); });&#xA;&#xA;// Example #3 -- create a container for a single Registry&#xA;            var container3 = Container.For&lt;FooBarRegistry&gt;();&#xA;</code></pre>
<div class="alert-info alert"><p><strong>Note!</strong>
The Lamar team highly recommends using <code>ServiceRegistry</code> classes for your real application configuration.  The syntax is shorter inside the Registry class constructor than from within the <code>Container</code> constructor method. In addition, Registry classes can be used to modularize the configuration of a bigger application into more manageable chunks.  Lastly, using <code>ServiceRegistry</code> classes makes it easier to stand up additional <code>Container</code> objects in testing scenarios that reflect the real application composition.</p>
</div>
<p>In real world applications you also have to deal with repetitive similar registrations. Such registrations are tedious, easy to forget and can be a weak spot in your application. Lamar provides <a href="/lamar/documentation/ioc/registration/auto-registration-and-conventions">Auto-Registration and Conventions</a>  which mitigates this pain and eases the maintenance burden. Lamar exposes this feature through the <a href="/lamar/documentation/ioc/registration/registry-dsl">ServiceRegistry DSL</a> by the <code>Scan</code> method.</p>
<p>In our example there is an reoccuring pattern, we are connecting the plugin type <code>ISomething</code> to a concrete type <code>Something</code>, meaning <code>IFoo</code> to <code>Foo</code> and <code>IBar</code> to <code>Bar</code>. Wouldn't it be cool if we could write a convention for exactly doing that? Fortunatly Lamar has already one build in. Let's see how we can create an container with the same configuration as in the above examples.</p>
<pre><code class="language-csharp">&#xA;// Example #1&#xA;            var container1 = new Container(c =&gt;&#xA;                c.Scan(scanner =&gt;&#xA;                {&#xA;                    scanner.TheCallingAssembly();&#xA;                    scanner.WithDefaultConventions();&#xA;                }));&#xA;&#xA;// Example #2&#xA;            var container2 = new Container();&#xA;&#xA;            container2.Configure(c =&gt;&#xA;                c.Scan(scanner =&gt;&#xA;                {&#xA;                    scanner.TheCallingAssembly();&#xA;                    scanner.WithDefaultConventions();&#xA;                }));&#xA;&#xA;&#xA;</code></pre>
<p>We instruct the scanner to scan through the calling assembly with default conventions on. This will find and register the default instance for <code>IFoo</code> and <code>IBar</code> which are obviously the concrete types <code>Foo</code> and <code>Bar</code>. Now whenever you add an additional interface <code>IMoreFoo</code> and a class <code>MoreFoo</code> to your application's code base, it's automatically picked up by the scanner.</p>
<p>Sometimes classes need to be supplied with some primitive value in its constructor. For example the <code>System.Data.SqlClient.SqlConnection</code> needs to be supplied with the connection string in its constructor. No problem, just set up the value of the constructor argument in the bootstrapping:</p>
<pre><code class="language-csharp">&#xA;var container = new Container(c =&gt;&#xA;{&#xA;    //just for demo purposes, normally you don&#x27;t want to embed the connection string directly into code.&#xA;    c.For&lt;IDbConnection&gt;().Use&lt;SqlConnection&gt;().Ctor&lt;string&gt;().Is(&quot;YOUR_CONNECTION_STRING&quot;);&#xA;    //a better way would be providing a delegate that retrieves the value from your app config.    &#xA;});&#xA;</code></pre>
<p>So far you have seen an couple of ways to work with the <a href="/lamar/documentation/ioc/registration/registry-dsl">ServiceRegistry DSL</a> and configure a <code>Container</code> object. We have seen examples of configuration that allow us to build objects that don't depend on anything like the <code>Bar</code> class, or do depend on other types like the <code>Foo</code> class needs an instance of <code>IBar</code>. In our last example we have seen configuration for objects that need some primitive types like strings in its constructor function.</p>

              </div>

              <hr />

              <nav>
                <span>
                  <strong>Previous: </strong><a href="/lamar/documentation/ioc/aspnetcore">Integration with ASP.Net Core</a>

                </span>
                <span class="pull-right">

                  <strong>Next: </strong><a href="/lamar/documentation/ioc/registration/registry-dsl">ServiceRegistry DSL</a>

                </span>
              </nav>

          </div><!--/right-->
        </div><!--/row-->
      </div><!--/container-->

    </body>


    <footer>
        <script type='text/javascript' src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script type='text/javascript' src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

        <script type="text/javascript" src="/lamar/content/prism.js"></script>
        <script type="text/javascript" src="/lamar/content/sidebar.js"></script>
        <script type="text/javascript" src="/lamar/content/affix.js"></script>

<script>
$('#search').keyup(function(e){
  if(e.keyCode == 13) {
    var search = $('#search').val();

    var url = 'https://www.google.com/#q=site:jasperfx.github.io ' + search;
    url = encodeURI(url);

    window.location.href = url;

    e.stopPropagation();
    if (e.cancelBubble!=null) e.cancelBubble = true;
    return false;
  }
});
</script>
    </footer>
</html>
