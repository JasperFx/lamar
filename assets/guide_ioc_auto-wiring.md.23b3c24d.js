import{_ as s,c as n,o as a,a as e}from"./app.5b13aa3a.js";const u=JSON.parse('{"title":"Auto Wiring","description":"","frontmatter":{},"headers":[],"relativePath":"guide/ioc/auto-wiring.md"}'),p={name:"guide/ioc/auto-wiring.md"},o=e(`<h1 id="auto-wiring" tabindex="-1">Auto Wiring <a class="header-anchor" href="#auto-wiring" aria-hidden="true">#</a></h1><p>The best way to use an IoC container is to allow &quot;Auto Wiring&quot; to do most of the work for you. IoC Containers like Lamar are an infrastructure concern, and as such, should be isolated from as much of your code as possible. Before examining Auto Wiring in depth, let&#39;s look at a common anti pattern of IoC usage:</p><p><a id="snippet-sample_shippingscreenpresenter-anti-pattern"></a></p><div class="language-cs"><button title="Copy Code" class="copy"></button><span class="lang">cs</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// This is the wrong way to use an IoC container.  Do NOT invoke the container from</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// the constructor function.  This tightly couples the ShippingScreenPresenter to</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// the IoC container in a harmful way.  This class cannot be used in either</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// production or testing without a valid IoC configuration.  Plus, you&#39;re writing more</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// code</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ShippingScreenPresenter</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">IContainer</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">container</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// It&#39;s even worse if you use a static facade to retrieve</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// a service locator!</span></span>
<span class="line"><span style="color:#A6ACCD;">    _service </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> container</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">GetInstance</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">IShippingService</span><span style="color:#89DDFF;">&gt;();</span></span>
<span class="line"><span style="color:#A6ACCD;">    _repository </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> container</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">GetInstance</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">IRepository</span><span style="color:#89DDFF;">&gt;();</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/Lamar.Testing/Examples/SetterExamples.cs#L201-L216" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_shippingscreenpresenter-anti-pattern" title="Start of snippet">anchor</a></sup></p><p>Instead of binding <code>ShippingScreenPresenter</code> so tightly to Lamar and having to explicitly fetch its dependencies, let&#39;s switch it to using Lamar a little more idiomatically and just exposing a constructor function with the necessary dependencies as arguments:</p><p><a id="snippet-sample_shippingscreenpresenter-with-ctor-injection"></a></p><div class="language-cs"><button title="Copy Code" class="copy"></button><span class="lang">cs</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// This is the way to write a Constructor Function with an IoC tool</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Let the IoC container &quot;inject&quot; services from outside, and keep</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ShippingScreenPresenter ignorant of the IoC infrastructure</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ShippingScreenPresenter</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">IShippingService</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">service</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">IRepository</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">repository</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    _service </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> service</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    _repository </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> repository</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/Lamar.Testing/Examples/SetterExamples.cs#L188-L199" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_shippingscreenpresenter-with-ctor-injection" title="Start of snippet">anchor</a></sup></p><p>As long as a Lamar <code>Container</code> knows how to resolve the <code>IRepository</code> and <code>IShippingService</code> interfaces, Lamar can build <code>ShippingScreenPresenter</code> by using &quot;auto-wiring.&quot; All this means is that instead of forcing you to explicitly configure all the dependencies for <code>ShippingScreenPresenter</code>, Lamar can infer from the public <a href="/lamar/guide/ioc/registration/constructor-selection.html">constructor function</a> what dependencies <code>ShippingScreenPresenter</code> needs and uses the defaults of both to build it out.</p><p>Looking at the <a href="/lamar/guide/ioc/diagnostics/build-plans.html">build plan</a> for <code>ShippingScreenPresenter</code>:</p><p><a id="snippet-sample_shippingscreenpresenter-build-plan"></a></p><div class="language-cs"><button title="Copy Code" class="copy"></button><span class="lang">cs</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">Fact</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ShowBuildPlan</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">container</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Container</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">_</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        _</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">For</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">IShippingService</span><span style="color:#89DDFF;">&gt;().</span><span style="color:#82AAFF;">Use</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">InternalShippingService</span><span style="color:#89DDFF;">&gt;();</span></span>
<span class="line"><span style="color:#A6ACCD;">        _</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">For</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">IRepository</span><span style="color:#89DDFF;">&gt;().</span><span style="color:#82AAFF;">Use</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">SimpleRepository</span><span style="color:#89DDFF;">&gt;();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// Just proving that we can build ShippingScreenPresenter;)</span></span>
<span class="line"><span style="color:#A6ACCD;">    container</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">GetInstance</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">ShippingScreenPresenter</span><span style="color:#89DDFF;">&gt;().</span><span style="color:#82AAFF;">ShouldNotBeNull</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">buildPlan</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> container</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Model</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">For</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">ShippingScreenPresenter</span><span style="color:#89DDFF;">&gt;().</span><span style="color:#A6ACCD;">Default</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">DescribeBuildPlan</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// _output is the xUnit ITestOutputHelper here</span></span>
<span class="line"><span style="color:#A6ACCD;">    _output</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">WriteLine</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">buildPlan</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/Lamar.Testing/Examples/SetterExamples.cs#L237-L257" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_shippingscreenpresenter-build-plan" title="Start of snippet">anchor</a></sup></p>`,14),l=[o];function t(r,c,i,F,y,D){return a(),n("div",null,l)}const A=s(p,[["render",t]]);export{u as __pageData,A as default};
